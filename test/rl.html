<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magyar Rulett Játék (6 Kamrás, Korrigált)</title>
    
    <link rel="stylesheet" href="../index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* [CSS stílusok, változatlanul] */
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
        }

        main {
            padding: 40px 20px;
            width: 100%;
            max-width: 900px;
        }

        .game-section {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border: 1px solid var(--card-border);
        }

        .status-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 15px;
            background-color: var(--dark-bg);
            border-radius: 8px;
            border: 1px solid var(--card-border);
        }

        .player-status, .ai-status {
            flex: 1;
            text-align: center;
            font-size: 1.1em;
            font-weight: 600;
            color: var(--text-light);
        }

        .hp-bar {
            width: 100%;
            height: 10px;
            background-color: var(--accent);
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }

        .hp-level {
            height: 100%;
            background-color: var(--secondary);
            transition: width 0.3s ease-out;
            width: 100%;
        }

        .ai-status {
            border-left: 2px solid var(--card-border);
        }
        .player-status {
            border-right: 2px solid var(--card-border);
        }

        #message {
            text-align: center;
            margin: 20px 0;
            font-size: 1.2em;
            font-weight: 700;
            color: var(--highlight);
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }
        
        button {
            padding: 14px 25px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1em;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            border: none;
            cursor: pointer;
            color: var(--text-light);
        }

        #shoot-self-btn, #shoot-opponent-btn {
            background-color: var(--primary-light);
        }

        #respin-btn {
            background-color: var(--accent);
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(0, 0, 0, 0.5);
        }

        button:disabled {
            background-color: var(--card-border);
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        #respin-btn:hover:not(:disabled) {
             background-color: #f39c12;
        }
        
        @media (max-width: 600px) {
            .status-container {
                flex-direction: column;
                gap: 15px;
            }
            .player-status, .ai-status {
                width: 100%;
                border: none;
                padding-bottom: 10px;
            }
            .ai-status {
                 border-top: 1px solid var(--card-border);
            }
            .action-buttons {
                flex-direction: column;
                gap: 10px;
            }
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>

<main>
    <section class="game-section">
        <h2 style="margin-top: 0; padding-bottom: 10px;">Magyar Rulett: Golyó a Tárban (6 Kamra)</h2>

        <div class="status-container">
            <div class="player-status">
                Játékos HP: <span id="player-hp">3.0</span>
                <div class="hp-bar"><div id="player-hp-level" class="hp-level"></div></div>
            </div>
            <div class="ai-status">
                Ellenfél HP: <span id="ai-hp">3.0</span>
                <div class="hp-bar"><div id="ai-hp-level" class="hp-level"></div></div>
            </div>
        </div>

        <div id="message">A játék kezdődik! Ki kezd?</div>

        <div class="action-buttons">
            <button id="respin-btn" onclick="respin()" disabled>Újrapörgetés (-0.1 HP)</button>
            <button id="shoot-self-btn" onclick="shoot('player')" disabled>Magamra lövök (1/kör)</button>
            <button id="shoot-opponent-btn" onclick="shoot('ai')" disabled>Ellenfélre lövök (Kör vége)</button>
        </div>
    </section>
</main>

<script>
    // --- JÁTÉK ÁLLAPOT VÁLTOZÓK ---
    let playerHP = 3.0;
    let aiHP = 3.0;
    let turn = ''; 
    let isGameOver = false;
    
    // ÚJ VÁLTOZÓ A KORLÁTOZÁSHOZ
    let selfShotUsedThisTurn = false; 

    // A TÁR ÁLLAPOTA (0=Üres, 1=Éles)
    let chambers = []; 
    const MAX_CHAMBERS = 6;

    // --- DOM ELEMEK ---
    const playerHpDisplay = document.getElementById('player-hp');
    const aiHpDisplay = document.getElementById('ai-hp');
    const playerHpLevel = document.getElementById('player-hp-level');
    const aiHpLevel = document.getElementById('ai-hp-level');
    const messageDisplay = document.getElementById('message');
    const respinBtn = document.getElementById('respin-btn');
    const shootSelfBtn = document.getElementById('shoot-self-btn');
    const shootOpponentBtn = document.getElementById('shoot-opponent-btn');

    // --- SEGÉD FUNKCIÓK ---

    function updateHPDisplay() {
        playerHpDisplay.textContent = playerHP.toFixed(1);
        aiHpDisplay.textContent = aiHP.toFixed(1);

        playerHpLevel.style.width = Math.max(0, (playerHP / 3) * 100) + '%';
        aiHpLevel.style.width = Math.max(0, (aiHP / 3) * 100) + '%';
    }
    
    function initialLoadAndSpin() {
        chambers = [0, 0, 0, 0, 0, 1]; 
        chambers.sort(() => Math.random() - 0.5); 
    }

    function fireGun() {
        if (chambers.length === 0) {
            initialLoadAndSpin(); 
        }

        const hit = (chambers[0] === 1);
        chambers.shift(); 

        if (hit) {
            initialLoadAndSpin(); 
        }
        
        return hit;
    }

    function checkGameOver() {
        if (playerHP <= 0) {
            playerHP = 0;
            updateHPDisplay();
            messageDisplay.innerHTML = `Vesztettél! Az Ellenfél nyert.`;
            isGameOver = true;
            disableButtons();
            return true;
        }
        if (aiHP <= 0) {
            aiHP = 0;
            updateHPDisplay();
            messageDisplay.innerHTML = `Nyertél! Az Ellenfél elesett.`;
            isGameOver = true;
            disableButtons();
            return true;
        }
        return false;
    }

    function disableButtons() {
        respinBtn.disabled = true;
        shootSelfBtn.disabled = true;
        shootOpponentBtn.disabled = true;
    }

    function setPlayerTurnControls() {
        if (isGameOver) {
            disableButtons();
            return;
        }
        
        const remainingChambers = chambers.length;
        
        turn = 'player';
        respinBtn.disabled = false;
        shootOpponentBtn.disabled = false;
        
        // Önlövés korlátozása
        shootSelfBtn.disabled = selfShotUsedThisTurn; 

        messageDisplay.innerHTML = `Te vagy soron! ${remainingChambers} kamra maradt. (Golyó esélye: 1/${remainingChambers})`;
        
        if (selfShotUsedThisTurn) {
            shootSelfBtn.textContent = 'Magadra lövök (Felhasznált)';
        } else {
            shootSelfBtn.textContent = 'Magamra lövök (1/kör)';
        }
    }

    /**
     * Fordulat átadása és állapot resetelése
     */
    function passTurn() {
        if (checkGameOver()) return;
        
        // Kör vége, reseteljük az önlövés limitet
        selfShotUsedThisTurn = false; 

        if (turn === 'player') {
            turn = 'ai';
            messageDisplay.textContent = 'Ellenfél következik...';
            setTimeout(aiTurn, 1500); 
        } else {
            setPlayerTurnControls();
        }
    }

    // --- JÁTÉKOS AKCIÓK ---

    /**
     * Újrapörgetés (-0.1 HP), turn continues.
     */
    window.respin = function() {
        if (turn !== 'player' || isGameOver) return;
        
        playerHP -= 0.1;
        
        if (checkGameOver()) return;

        initialLoadAndSpin(); 
        updateHPDisplay();
        
        messageDisplay.innerHTML = 'Újrapörgetted a tárat! (-0.1 HP). A kör nálad marad!';
        
        setPlayerTurnControls(); 
    }

    /**
     * Lövés (önmagára vagy ellenségre)
     */
    window.shoot = function(target) {
        if (turn !== 'player' || isGameOver) return;
        
        if (target === 'player' && selfShotUsedThisTurn) {
            messageDisplay.innerHTML = 'HIBA: Már használtad az önlövés jogát ebben a körben!';
            return;
        }

        disableButtons();
        
        const hit = fireGun();
        const chamberStatus = hit ? 'ÉLES GOLYÓ' : 'ÜRES TÁR';
        let turnPasses = (target === 'ai' || hit); 
        
        let targetName = (target === 'player') ? 'magadra' : 'az Ellenfélre';
        messageDisplay.innerHTML = `A Játékos lő ${targetName}... [Kamra: ${chamberStatus}]`;
        
        if (target === 'player') {
             selfShotUsedThisTurn = true; // Elhasználta a jogot
        }

        setTimeout(() => {
            if (hit) {
                if (target === 'player') {
                    playerHP -= 1;
                    messageDisplay.innerHTML = `BUMM! Elvetted magadtól -1 HP-t. A tár újra pörög!`;
                } else {
                    aiHP -= 1;
                    messageDisplay.innerHTML = `Sikeres lövés! Az Ellenfél elveszített -1 HP-t. A tár újra pörög!`;
                }
                turnPasses = true; // Találat esetén a kör mindig átmegy a lőszer elhasználása miatt.
            } else {
                messageDisplay.innerHTML = `KATT! Üres volt. `;
            }
            
            updateHPDisplay();

            if (turnPasses) {
                passTurn();
            } else {
                // Magára lőtt, és mellé ment. Kör folytatódik.
                messageDisplay.innerHTML += ` A kör nálad marad!`;
                setPlayerTurnControls(); 
            }
        }, 1000);
    }

    // --- AI LOGIKA ---

    function aiTurn() {
        if (isGameOver) return;
        
        const remainingChambers = chambers.length;
        const P_live = 1 / remainingChambers;
        
        let aiAction = ''; // 'respin', 'shoot-self', 'shoot-player'

        // AI DÖNTÉS: 
        if (P_live >= 1/3) { 
            if (playerHP <= 1) {
                aiAction = 'shoot-player';
            } else {
                aiAction = 'respin';
            }
        } else {
            // AI okos lépése: alacsony valószínűség -> magára lő, hogy a veszélyt a játékosra hagyja.
            aiAction = 'shoot-self';
        }

        // AKCIÓ VÉGREHAJTÁSA (Az AI köre mindig véget ér a lövéssel, mivel a szabály csak a játékosra vonatkozik)
        
        if (aiAction === 'respin') {
            aiHP -= 0.1;
            initialLoadAndSpin();
            updateHPDisplay();
            messageDisplay.innerHTML = `Az Ellenfél újrapörget! (-0.1 HP). Esély most: 1/6`;
            
            // Az AI-nak lőnie kell, a döntés újraindul
            setTimeout(aiTurn, 1000); 
            return;
        }

        setTimeout(() => {
            const target = (aiAction === 'shoot-self') ? 'ai' : 'player';
            const hit = fireGun();
            const chamberStatus = hit ? 'ÉLES GOLYÓ' : 'ÜRES TÁR';
            
            let targetName = (target === 'ai') ? 'magára' : 'a Játékosra';
            messageDisplay.innerHTML = `Az Ellenfél lő ${targetName}... [Kamra: ${chamberStatus}]`;

            setTimeout(() => {
                if (hit) {
                    if (target === 'ai') {
                        aiHP -= 1;
                        messageDisplay.innerHTML = `BUMM! Az Ellenfél eltalálta magát (-1 HP). A tár újra pörög!`;
                    } else {
                        playerHP -= 1;
                        messageDisplay.innerHTML = `Sikeres lövés! A Játékos elveszített -1 HP-t. A tár újra pörög!`;
                    }
                } else {
                    messageDisplay.innerHTML = `KATT! Üres volt. `;
                }

                updateHPDisplay();
                passTurn();
            }, 1000);
        }, 1000);
    }

    // --- INDÍTÁS ---

    function initGame() {
        playerHP = 3.0;
        aiHP = 3.0;
        isGameOver = false;
        selfShotUsedThisTurn = false; 
        initialLoadAndSpin();
        updateHPDisplay();
        
        turn = (Math.random() < 0.5) ? 'player' : 'ai';
        
        messageDisplay.innerHTML = `A tár pörög. Kezdő: ${turn === 'player' ? 'Játékos' : 'Ellenfél'}`;

        if (turn === 'player') {
            setPlayerTurnControls();
        } else {
            disableButtons();
            setTimeout(aiTurn, 2000); 
        }
    }

    initGame();
</script>

</body>
</html>
